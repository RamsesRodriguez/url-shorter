---
import { getSession } from "auth-astro/server";
import { Github } from "lucide-react";

import { ModeToggle } from "@/components/mode-toggle";
import { buttonVariants } from "@/components/ui/button";
import { AuthIn } from "@/components/auth";
import { cn } from "@/lib/utils";

import { CommandHeader } from "./command-header";
import { DropdownHeader } from "./dropdown-header";

const session = await getSession(Astro.request);
---

<header
  class="sticky top-0 z-50 w-full border-b border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60"
>
  <div class="container flex h-14 max-w-screen-2xl items-center">
    <a
      href="/"
      class="flex items-center cursor-pointer text-white hover:text-gray-300 transition-all"
    >
      <h1 class="text-xl">URL Shorter</h1>
    </a>
    <div
      class="flex flex-1 items-center justify-between space-x-2 md:justify-end"
    >
      <div class="w-full flex-1 md:w-auto md:flex-none">
        <CommandHeader session={session} client:load />
      </div>
      <nav class="flex items-center gap-2">
        {
          session ? (
            <DropdownHeader session={session} client:load />
          ) : (
            <AuthIn
              provider="github"
              className={cn(
                "relative h-8 justify-start rounded-[0.5rem] text-sm font-normal"
              )}
              client:only
            >
              Login with GitHub
            </AuthIn>
          )
        }
        <a
          href="https://github.com/RamsesRodriguez/url-shorter"
          target="_blank"
          rel="noreferrer"
        >
          <div
            class={cn(
              buttonVariants({
                variant: "ghost",
                size: "icon",
              }),
              "text-foreground rounded-full"
            )}
          >
            <Github className="h-4 w-4" />
            <span class="sr-only">GitHub</span>
          </div>
        </a>
        <ModeToggle client:load />
      </nav>
    </div>
  </div>
</header>
